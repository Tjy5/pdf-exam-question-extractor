# é¡¹ç›®è¯´æ˜ & ç»™åç»­ AI çš„æç¤º (v2.0.2)

> **âš ï¸ é‡è¦æ›´æ–°**: æœ¬é¡¹ç›®å·²äº 2025-12-13 æ›´æ–°åˆ° v2.0.2ï¼Œæ–°å¢é¡µé¢çº§å¹¶å‘å¤„ç†åŠŸèƒ½ï¼Œé¢˜ç›®æå–é€Ÿåº¦æå‡2-3å€ã€‚å¦‚æœä½ æ˜¯ä¹‹å‰å‚ä¸è¿‡v1.xçš„AIï¼Œè¯·ä¼˜å…ˆé˜…è¯»æœ¬æ–‡æ¡£çš„"æ¶æ„å˜æ›´è¯´æ˜"éƒ¨åˆ†ã€‚

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**æŠŠ PDF è¯•å·é¡µé¢è‡ªåŠ¨åˆ‡åˆ†æˆå•é¢˜å›¾ç‰‡ï¼Œå¹¶ä¿ç•™é¢˜ç›®æ–‡å­—/è¡¨æ ¼ç»“æ„**çš„æ™ºèƒ½å·¥å…·ã€‚ä½¿ç”¨ **PaddleOCR 3.x + PP-StructureV3** è¿›è¡Œç‰ˆé¢è§£æå’Œæ–‡å­—è¯†åˆ«ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- ğŸ¯ è‡ªåŠ¨è¯†åˆ«é¡µé¢å¸ƒå±€å’Œæ–‡å­—
- ğŸ“ æŒ‰é¢˜å·å°†é¡µé¢åˆ’åˆ†æˆå•é¢˜
- ğŸ“Š è¾“å‡ºæ¯é“é¢˜çš„æˆªå›¾ + æ–‡å­—å’Œè¡¨æ ¼ç»“æ„
- ğŸ”— æ”¯æŒè·¨é¡µé¢˜ç›®è‡ªåŠ¨æ‹¼æ¥
- ğŸ“ˆ ç‰¹æ®Šå¤„ç†èµ„æ–™åˆ†æå¤§é¢˜
- ğŸŒ æä¾›Webç•Œé¢å’Œè„šæœ¬ä¸¤ç§ä½¿ç”¨æ–¹å¼
- ğŸ’¾ æ•°æ®åº“æŒä¹…åŒ–ï¼šSQLiteå­˜å‚¨ä»»åŠ¡çŠ¶æ€ï¼Œæ”¯æŒå†å²è®°å½•å’Œæ–­ç‚¹ç»­è·‘
- âš¡ æ”¯æŒæ¨¡å‹é¢„çƒ­å’ŒGPUåŠ é€Ÿ
- ğŸ”„ è‡ªåŠ¨/æ‰‹åŠ¨ä¸¤ç§å¤„ç†æ¨¡å¼

---

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# æ ¸å¿ƒä¾èµ–
pip install -r requirements.txt

# Webç•Œé¢ä¾èµ–ï¼ˆå¿…éœ€ï¼‰
pip install -r web_requirements.txt

# å›½å†…é•œåƒæºï¼ˆå¯é€‰ï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install -r web_requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

> **æ³¨æ„**: å¦‚æœé‡åˆ° `ModuleNotFoundError: No module named 'aiosqlite'`ï¼Œè¯·æ‰‹åŠ¨å®‰è£…ï¼š
> ```bash
> pip install aiosqlite
> ```

### 2. å¯åŠ¨æ–¹å¼

#### Web ç•Œé¢ï¼ˆæ¨èï¼‰
```bash
# Windows: åŒå‡»å¯åŠ¨
start_web_fixed.bat

# æˆ–æ‰‹åŠ¨å¯åŠ¨
python web_interface/app.py

# è‡ªå®šä¹‰ç«¯å£ï¼ˆå¯é€‰ï¼‰
python -m uvicorn web_interface.app:app --host 127.0.0.1 --port 9000 --reload
```

> **é‡è¦è¯´æ˜**:
> - `manage.py` ç›®å‰ä»æ˜¯ Flask é£æ ¼çš„ `app.run()` å¯åŠ¨æ–¹å¼ï¼Œæœªé€‚é… FastAPI
> - è¯·ä¼˜å…ˆä½¿ç”¨ä¸Šè¿°å¯åŠ¨æ–¹å¼
> - CLI äº¤äº’å¼èœå•å·²åœ¨ v2.0.1 ç§»é™¤

### 3. è®¿é—®åœ°å€

å¯åŠ¨WebæœåŠ¡åï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8000
```

---

## ğŸ’¡ Web ç•Œé¢ä½¿ç”¨æŒ‡å—

### ä¸»è¦åŠŸèƒ½

1. **PDF è½¬å›¾ç‰‡** - è‡ªåŠ¨å°†PDFè¯•å·è½¬æ¢ä¸ºé«˜æ¸…å›¾åƒ
2. **æ™ºèƒ½åˆ‡é¢˜** - AIè‡ªåŠ¨è¯†åˆ«å¹¶åˆ†å‰²æ¯é“é¢˜ç›®
3. **èµ„æ–™åˆ†æé‡ç»„** - æ™ºèƒ½è¯†åˆ«è·¨é¡µçš„èµ„æ–™åˆ†æå¤§é¢˜
4. **é•¿å›¾æ‹¼æ¥** - å°†åˆ†æ•£çš„é¢˜ç›®å’Œé€‰é¡¹æ‹¼æ¥æˆå®Œæ•´å›¾ç‰‡
5. **ç»“æœä¸‹è½½** - ä¸€é”®æ‰“åŒ…ä¸‹è½½æ‰€æœ‰é¢˜ç›®å›¾ç‰‡

### ä½¿ç”¨æ­¥éª¤

1. **ä¸Šä¼ PDFæ–‡ä»¶** - ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æ‹–æ‹½PDFæ–‡ä»¶ï¼ˆå»ºè®® < 100MBï¼‰ï¼Œå¯é€‰æ‹©è‡ªåŠ¨/æ‰‹åŠ¨æ¨¡å¼
2. **å¼€å§‹å¤„ç†** - ç‚¹å‡»ã€Œå¼€å§‹å¤„ç†ã€æŒ‰é’®ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œ5ä¸ªæ­¥éª¤
3. **æŸ¥çœ‹è¿›åº¦** - å·¦ä¾§æ˜¾ç¤ºå®æ—¶æ—¥å¿—ï¼Œå³ä¾§æ˜¾ç¤ºå¯è§†åŒ–è¿›åº¦
4. **ä¸‹è½½ç»“æœ** - åœ¨ã€Œè¯†åˆ«ç»“æœå±•ç¤ºã€æŸ¥çœ‹å¹¶ä¸‹è½½é¢˜ç›®å›¾ç‰‡

### ä¸¤ç§å¤„ç†æ¨¡å¼

**è‡ªåŠ¨æ¨¡å¼**ï¼ˆé»˜è®¤ï¼‰:
- ä¸Šä¼ åç‚¹å‡»"å¼€å§‹å¤„ç†"ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆæ‰€æœ‰5ä¸ªæ­¥éª¤
- é€‚åˆå¿«é€Ÿæ‰¹é‡å¤„ç†

**æ‰‹åŠ¨æ¨¡å¼**:
- ä¸Šä¼ æ—¶é€‰æ‹©"æ‰‹åŠ¨æ¨¡å¼"
- å¯ä»¥å•ç‹¬æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ï¼Œä¾¿äºæ£€æŸ¥ä¸­é—´ç»“æœ
- é€šè¿‡ `/api/tasks/{id}/steps/{step}/start` å•ç‹¬è§¦å‘

### æ–­ç‚¹ç»­è·‘æœºåˆ¶

- ä¸Šä¼ ç›¸åŒPDFæ—¶ï¼ˆé€šè¿‡å†…å®¹å“ˆå¸Œè¯†åˆ«ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ `pdf_images/{clean_name}__{hash8}/` ç›®å½•
- æ‰«æå·²æœ‰çš„ `page_*.png`ã€`questions_page_*/meta.json` ç­‰æ–‡ä»¶ï¼Œæ¨æ–­å·²å®Œæˆçš„æ­¥éª¤
- åªå¤„ç†æœªå®Œæˆçš„éƒ¨åˆ†ï¼ŒèŠ‚çœæ—¶é—´
- æœåŠ¡å™¨é‡å¯åå¯ä» `data/tasks.db` æ¢å¤å†å²ä»»åŠ¡

### ç•Œé¢è¯´æ˜

- **å·¦ä¾§é¢æ¿**: æ–‡ä»¶ä¸Šä¼ åŒº + ç³»ç»Ÿæ—¥å¿—ï¼ˆç»ˆç«¯é£æ ¼ï¼‰
- **å³ä¾§é¢æ¿**: å¤„ç†æµç¨‹è¿›åº¦ + è¯†åˆ«ç»“æœå±•ç¤ºï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰

### ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
pdf_images/{clean_name}__{hash8}/    # å½“å‰ä¸»æµç¨‹é»˜è®¤è¾“å‡ºç›®å½•
â”œâ”€â”€ page_*.png                       # æ•´é¡µå›¾ç‰‡
â”œâ”€â”€ questions_page_*/                # åˆ†é¡µåˆ‡é¢˜äº§ç‰©ï¼ˆæ¯é¡µä¸€ä¸ªç›®å½•ï¼‰
â”‚   â”œâ”€â”€ q*.png                        # å•é¢˜æˆªå›¾
â”‚   â”œâ”€â”€ q*_part2.png                  # è·¨é¡µç»­æ¥ç‰‡æ®µï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ q*_long.png                   # è·¨é¡µé•¿å›¾ï¼ˆå¯é€‰ï¼Œç”± compose_question_long_image.py ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ big_*.png / big_*_part*.png   # èµ„æ–™åˆ†æææ–™è£å‰ªï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ data_analysis_*_long.png      # èµ„æ–™åˆ†æå¤§é¢˜é•¿å›¾ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ meta.json                     # å½“å‰é¡µç»“æ„åŒ–å…ƒæ•°æ®ï¼ˆquestions/big_questions ç­‰ï¼‰
â”œâ”€â”€ exam_questions.json               # å…¨å·æ±‡æ€»ï¼ˆextract_questions_ppstruct.py ç”Ÿæˆï¼‰
â”œâ”€â”€ all_questions/                    # Web"ç»“æœæ±‡æ€»"è¾“å‡ºç›®å½•ï¼ˆæ­¥éª¤4ï¼‰
â”œâ”€â”€ job_meta.json                     # Web ä¸Šä¼ ä»»åŠ¡å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ .source_hash                      # PDF å†…å®¹ hashï¼ˆå¯é€‰ï¼‰

data/tasks.db                         # Web ä»»åŠ¡/æ—¥å¿—æŒä¹…åŒ–ï¼ˆSQLiteï¼‰
web_interface/uploads/{task_id}/      # ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ç›®å½•
```

> **é‡è¦**: å½“å‰ä¸»æµç¨‹ä½¿ç”¨ `pdf_images/`ï¼Œè€Œéæ–‡æ¡£æ—©æœŸç‰ˆæœ¬æåˆ°çš„ `data/output/`ã€‚è¿ç§»è„šæœ¬è¾“å‡ºåˆ° `data/output/`ï¼Œä½†ä¸»æµç¨‹æœªæ¥å…¥ã€‚

### æ³¨æ„äº‹é¡¹

- **é¦–æ¬¡è¿è¡Œ**: è‡ªåŠ¨ä¸‹è½½PaddleOCRæ¨¡å‹ï¼ˆçº¦100MBï¼‰ï¼Œéœ€è¦ç½‘ç»œè¿æ¥
- **å¤„ç†æ—¶é—´**: 10-20é¡µè¯•å·çº¦2-5åˆ†é’Ÿï¼ˆå–å†³äºæ˜¯å¦å¯ç”¨GPUåŠ é€Ÿï¼‰
- **ç³»ç»Ÿè¦æ±‚**: Python 3.8+ï¼Œæ¨è8GB+å†…å­˜ï¼ŒGPUå¯é€‰ä½†æ¨è
- **æµè§ˆå™¨**: æ¨èChromeã€Edgeã€Firefoxï¼Œä¸æ”¯æŒIE

---

## ğŸ†• v2.0.1 æ¶æ„å˜æ›´è¯´æ˜ï¼ˆé‡è¦ï¼ï¼‰

### å…³é”®å˜æ›´

| æ–¹é¢ | v1.x | v2.0/v2.0.1 |
|------|------|------|
| **å…¥å£** | å¤šä¸ªç‹¬ç«‹è„šæœ¬ | Webä¸ºä¸»ï¼š`web_interface/app.py`ï¼ˆ`manage.py` æœªé€‚é…FastAPIï¼‰ |
| **å…¬å…±æ¨¡å—** | å•æ–‡ä»¶ `common.py` (692è¡Œ) | æ¨¡å—åŒ– `src/common/` |
| **é…ç½®** | ç¡¬ç¼–ç åœ¨è„šæœ¬ä¸­ | `config/*.yaml` å·²æ•´ç†ï¼Œä½†ä¸»æµç¨‹ä»¥ç¯å¢ƒå˜é‡ä¸ºä¸» |
| **æ•°æ®ç›®å½•** | `pdf_images/` (æ··åœ¨æ ¹ç›®å½•) | ä»ä»¥ `pdf_images/` ä¸ºä¸»ï¼Œä½†å‘½åæ›´ç¨³å®šï¼ˆ`clean_name__hash8`ï¼‰ |
| **ä»»åŠ¡æŒä¹…åŒ–** | æ—  | `data/tasks.db` (SQLite) å­˜å‚¨ä»»åŠ¡çŠ¶æ€å’Œå†å² |
| **æ–‡æ¡£** | å•ä¸€README | åˆ†ç±»æ–‡æ¡£ `docs/` |
| **Git** | è¿½è¸ªæ‰€æœ‰æ•°æ® | åªè¿½è¸ªä»£ç  |

### æ–°ç›®å½•ç»“æ„

```
newvl/                            # v2.0.1
â”œâ”€â”€ src/                          # â­ æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ common/                   # å…¬å…±æ¨¡å—ï¼ˆå·²æ¨¡å—åŒ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.py              # å¸¸é‡å’Œç±»å‹
â”‚   â”‚   â”œâ”€â”€ paths.py              # è·¯å¾„å·¥å…·
â”‚   â”‚   â”œâ”€â”€ io.py                 # JSONè¯»å†™
â”‚   â”‚   â”œâ”€â”€ image.py              # å›¾ç‰‡å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ocr_models.py         # OCRæ¨¡å‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ db/                       # â­ æ•°æ®åº“å±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ connection.py         # SQLiteè¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ schema.py             # è¡¨ç»“æ„å®šä¹‰
â”‚   â”‚   â””â”€â”€ crud.py               # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒç®—æ³•
â”‚   â”œâ”€â”€ ocr/                      # OCRå°è£…
â”‚   â”œâ”€â”€ postprocess/              # åå¤„ç†
â”‚   â”œâ”€â”€ compose/                  # é•¿å›¾æ‹¼æ¥
â”‚   â”œâ”€â”€ analysis/                 # æ•°æ®åˆ†æ
â”‚   â””â”€â”€ services/                 # æœåŠ¡å±‚
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶ï¼ˆå·²æ•´ç†ï¼Œæœªæ¥å…¥ä¸»æµç¨‹ï¼‰
â”‚   â”œâ”€â”€ global_settings.yaml
â”‚   â”œâ”€â”€ exam_gd_2025.yaml
â”‚   â””â”€â”€ exam_sihai_2025.yaml
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•ï¼ˆä¸å…¥Gitï¼‰
â”‚   â””â”€â”€ tasks.db                  # â­ Webä»»åŠ¡æ•°æ®åº“ï¼ˆSQLiteï¼‰
â”œâ”€â”€ pdf_images/                   # â­ å¤„ç†ç»“æœï¼ˆé»˜è®¤è¾“å‡ºç›®å½•ï¼‰
â”‚   â”œâ”€â”€ .last_processed           # æœ€è¿‘å¤„ç†çš„è¯•å·
â”‚   â””â”€â”€ {clean_name}__{hash8}/    # è¯•å·ç›®å½•
â”œâ”€â”€ scripts/                      # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ archived/                 # å®éªŒä»£ç å½’æ¡£
â”‚   â””â”€â”€ migrate_data_v1_to_v2.py  # æ•°æ®è¿ç§»å·¥å…·
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”œâ”€â”€ web_interface/                # Webç•Œé¢
â”‚   â”œâ”€â”€ app.py                    # FastAPIåº”ç”¨
â”‚   â”œâ”€â”€ templates/                # å‰ç«¯æ¨¡æ¿
â”‚   â”œâ”€â”€ static/                   # é™æ€èµ„æº
â”‚   â””â”€â”€ uploads/                  # ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ç›®å½•
â”œâ”€â”€ manage.py                     # ç»Ÿä¸€å…¥å£ï¼ˆâš ï¸ æœªé€‚é…FastAPIï¼‰
â”œâ”€â”€ start_web_fixed.bat           # Windows Webå¯åŠ¨è„šæœ¬
â”œâ”€â”€ common.py                     # å‘åå…¼å®¹æ¨¡å—ï¼ˆæ¡¥æ¥åˆ° src/commonï¼‰
â”œâ”€â”€ extract_questions_ppstruct.py # ä¸»å¤„ç†è„šæœ¬
â”œâ”€â”€ make_data_analysis_big.py     # èµ„æ–™åˆ†æå¤„ç†
â”œâ”€â”€ compose_question_long_image.py # é•¿å›¾æ‹¼æ¥
â”œâ”€â”€ pdf_to_images.py              # PDFè½¬å›¾ç‰‡
â”œâ”€â”€ requirements.txt              # æ ¸å¿ƒä¾èµ–
â”œâ”€â”€ web_requirements.txt          # Webä¾èµ–
â””â”€â”€ .gitignore
```

### å‘åå…¼å®¹æ€§

âœ… **ç°æœ‰è„šæœ¬æ— éœ€ä¿®æ”¹**ï¼Œv1.xçš„è°ƒç”¨æ–¹å¼ä»ç„¶æœ‰æ•ˆï¼š
- `common.py` ä½œä¸ºå…¼å®¹å±‚é‡æ–°å¯¼å‡º `src.common` çš„å‡½æ•°
- æ‰€æœ‰ `from common import xxx` ä»ç„¶æœ‰æ•ˆ
- Webç•Œé¢ä½¿ç”¨ `start_web_fixed.bat` å¿«æ·å¯åŠ¨

âš ï¸ **æ¨èæ–°ä»£ç ä½¿ç”¨æ–°å¯¼å…¥æ–¹å¼**ï¼š
```python
# v1.xï¼ˆä»ç„¶æ”¯æŒï¼‰
from common import get_ppstructure, load_meta

# v2.0+ï¼ˆæ¨èï¼‰
from src.common.ocr_models import get_ppstructure
from src.common.io import load_meta
from src.common.paths import resolve_image_path
```

### æ•°æ®åº“ç³»ç»Ÿï¼ˆv2.0.1æ–°å¢ï¼‰

**ç”¨é€”**: æŒä¹…åŒ–ä»»åŠ¡å…ƒä¿¡æ¯ã€5æ­¥çŠ¶æ€ä¸æ—¥å¿—

**è¡¨ç»“æ„** (`data/tasks.db`):
- `tasks`: ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ï¼ˆtask_idã€modeã€pdf_nameã€file_hashã€exam_dir_nameã€statusã€current_stepç­‰ï¼‰
- `task_steps`: 5ä¸ªæ­¥éª¤è¯¦ç»†çŠ¶æ€ï¼ˆå¤åˆä¸»é”®ï¼ŒåŒ…å«started_atã€ended_atã€artifact_jsonã€error_messageï¼‰
- `task_logs`: å¤„ç†æ—¥å¿—ï¼ˆappend-onlyï¼Œç±»å‹ä¸ºdefault|info|success|errorï¼‰

**è¿è¡ŒæœŸè¡Œä¸º**:
- `/api/status/{task_id}`: è¯»å–å†…å­˜ `TASKS`ï¼ˆå®æ—¶çŠ¶æ€ï¼‰
- `/api/history/*`: è¯»å–æ•°æ®åº“ï¼ˆå†å²è®°å½•ï¼‰
- æœåŠ¡é‡å¯åï¼šå†å²å¯æŸ¥ï¼Œä½†åŸtask_idå®æ—¶statuså¯èƒ½404ï¼ˆå› ä¸ºå†…å­˜ä¸ä¼šä»DBå›çŒï¼‰

**ä¾èµ–**: ä½¿ç”¨ `aiosqlite` å®ç°å¼‚æ­¥SQLiteï¼ˆéœ€æ‰‹åŠ¨å®‰è£…ï¼Œæœªåœ¨requirementsä¸­å£°æ˜ï¼‰

---

## ğŸ“ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. `src/common/` - å…¬å…±æ¨¡å—ï¼ˆå·²æ¨¡å—åŒ–ï¼‰

**v2.0 å°†åŸ `common.py` (692è¡Œ) æ‹†åˆ†ä¸º6ä¸ªä¸“é—¨æ¨¡å—**ï¼š

#### `types.py` - å¸¸é‡å’Œç±»å‹å®šä¹‰
- é¢˜å·è¯†åˆ«æ­£åˆ™ï¼š`QUESTION_HEAD_PATTERN`
- å¤§é¢˜å…³é”®å­—ï¼š`SECTION_HEAD_KEYWORDS`
- å™ªå£°å…³é”®å­—ï¼š`NOISE_TEXT_KEYWORDS`
- è·¯å¾„å¸¸é‡ï¼š`DEFAULT_DATA_DIR`, `LEGACY_PDF_IMAGES_DIR`

#### `paths.py` - è·¯å¾„å·¥å…·
- `page_index()` - é¡µç æ’åº
- `resolve_image_path()` - è·¯å¾„è§£æï¼ˆâœ¨ æ”¯æŒç›®å½•é‡å‘½ååçš„è·¯å¾„ä¿®å¤ï¼‰
- `get_meta_path()` - è·å–meta.jsonè·¯å¾„
- `iter_meta_paths()` - éå†metaæ–‡ä»¶
- `auto_latest_exam_dir()` - è‡ªåŠ¨é€‰æ‹©æœ€è¿‘è¯•å·ç›®å½•
- `get_data_dir()` - è·å–æ•°æ®ç›®å½•
- `resolve_exam_dir_by_hash()` - åŸºäºPDF hashçš„ç›®å½•ç®¡ç†

#### `io.py` - æ–‡ä»¶IOæ“ä½œ
- `load_meta()` / `save_meta()` - meta.jsonè¯»å†™
- `load_json()` / `save_json()` - é€šç”¨JSONæ“ä½œ

#### `image.py` - å›¾ç‰‡å¤„ç†
- `union_boxes()` - è®¡ç®—bboxå¹¶é›†
- `crop_and_save()` - è£å‰ªå¹¶ä¿å­˜å›¾ç‰‡
- `crop_page_and_save()` - æŒ‰é¡µé¢è£å‰ª
- `compose_vertical()` - å‚ç›´æ‹¼æ¥é•¿å›¾
- `compute_smart_crop_box()` - æ™ºèƒ½è£å‰ªè¾¹ç•Œè®¡ç®—
- `find_footer_top_from_meta()` - é¡µè„šä½ç½®æ£€æµ‹

#### `ocr_models.py` - OCRæ¨¡å‹ç®¡ç†
- `get_ppstructure()` - PP-StructureV3å•ä¾‹
- `layout_blocks_from_doc()` - ç‰ˆé¢å—æ ‡å‡†åŒ–
- `get_offline_model_path()` - ç¦»çº¿æ¨¡å‹è·¯å¾„

#### `utils.py` - ç‰ˆé¢åˆ†æå·¥å…·
- `is_section_boundary_block()` - åˆ¤æ–­åˆ†åŒºæ ‡é¢˜
- `detect_section_boundaries()` - æ£€æµ‹æ‰€æœ‰åˆ†åŒºè¾¹ç•Œ
- `detect_continuation_blocks()` - è·¨é¡µç»­æ¥æ£€æµ‹ï¼ˆå¸¦ç½®ä¿¡åº¦ï¼‰

### 2. `config/` - é…ç½®ç®¡ç†ç³»ç»Ÿ

#### é…ç½®æ–‡ä»¶å±‚çº§
```
global_settings.yaml (å…¨å±€é»˜è®¤)
    â†“ è¦†ç›–
exam_*.yaml (è¯•å·ç‰¹å®šé…ç½®)
    â†“ è¦†ç›–
å‘½ä»¤è¡Œå‚æ•°
```

#### é…ç½®æ–‡ä»¶ç»“æ„ç¤ºä¾‹
```yaml
# config/global_settings.yaml
ocr:
  engine: paddle
  gpu_enable: false

extraction:
  question_pattern: '(?:^|\n|ã€‚)\s*(\d{1,3})[\.ï¼ã€]\s*'
  margin_ratio: 0.008

paths:
  input_dir: data/input
  output_dir: data/output
```

### 3. ä¸»è¦å¤„ç†è„šæœ¬

#### `extract_questions_ppstruct.py` - é¢˜ç›®æå–
- ä½¿ç”¨ PP-StructureV3 è¿›è¡Œç‰ˆé¢åˆ†æ
- è‡ªåŠ¨è¯†åˆ«é¢˜å·ã€å¤§é¢˜æ ‡é¢˜
- å¤„ç†è·¨é¡µç»­æ¥
- è¾“å‡ºç»“æ„åŒ–JSON

#### `make_data_analysis_big.py` - èµ„æ–™åˆ†æå¤„ç†
- è‡ªåŠ¨è¯†åˆ«èµ„æ–™åˆ†æé¡µé¢
- ç”Ÿæˆå¤§é¢˜çº§æˆªå›¾
- è¾“å‡º `big_questions` ç»“æ„

#### `compose_question_long_image.py` - é•¿å›¾æ‹¼æ¥
- æ‹¼æ¥è·¨é¡µé¢˜ç›®
- ç”Ÿæˆé•¿å›¾
- æ›´æ–°metaä¿¡æ¯

---

## âš™ï¸ é…ç½®ç³»ç»Ÿ

### é…ç½®ä¼˜å…ˆçº§

```
ç¡¬ç¼–ç  < å…¨å±€é…ç½® < è¯•å·é…ç½® < å‘½ä»¤è¡Œå‚æ•°
```

å§‹ç»ˆä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œé¿å…ç¡¬ç¼–ç ã€‚

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

| ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|---------|--------|------|
| **æ ¸å¿ƒä¼˜åŒ–** |||
| `EXAMPAPER_STEP1_INPROC` | `1` | è¿›ç¨‹å†…æ‰§è¡Œï¼ˆé¿å…é‡å¤åŠ è½½æ¨¡å‹ï¼‰ |
| `EXAMPAPER_PPSTRUCTURE_WARMUP` | `1` | å¯åŠ¨æ—¶é¢„çƒ­æ¨¡å‹ |
| `EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC` | `0` | é˜»å¡å¯åŠ¨ï¼ˆç­‰å¾…æ¨¡å‹å°±ç»ªï¼‰ |
| `EXAMPAPER_STEP1_FALLBACK_SUBPROCESS` | `1` | å…è®¸å›é€€åˆ°å­è¿›ç¨‹ |
| **GPU åŠ é€Ÿ** |||
| `EXAMPAPER_USE_GPU` | `1` | å¯ç”¨GPUåŠ é€Ÿï¼ˆæ¨èRTX 3060+ï¼Œé»˜è®¤å¼€å¯ï¼‰ |
| `FLAGS_fraction_of_gpu_memory_to_use` | `0.8` | GPUæ˜¾å­˜ä½¿ç”¨é™åˆ¶ï¼ˆ80%ï¼‰ |
| **å¹¶å‘å¤„ç†** |||
| `EXAMPAPER_PARALLEL_EXTRACTION` | `0` | å¯ç”¨é¡µé¢çº§å¹¶å‘æå–ï¼ˆæ¨èå¯ç”¨ï¼‰ |
| `EXAMPAPER_MAX_WORKERS` | `4` | å¹¶å‘workeræ•°é‡ï¼ˆå»ºè®®2-6ï¼‰ |
| **å…¶ä»–** |||
| `EXAMPAPER_LIGHT_TABLE` | `0` | ä¿ç•™è¡¨æ ¼è¯†åˆ«ï¼ˆç¦ç”¨ä¼šå½±å“èµ„æ–™åˆ†æï¼‰ |
| `EXAMPAPER_STRICT_STARTUP` | `0` | æ¨¡å‹é¢„çƒ­å¤±è´¥æ—¶æ˜¯å¦æ‹’ç»å¯åŠ¨ |
| `EXAMPAPER_ALLOW_MODEL_RELOAD` | `0` | å¯ç”¨æ‰‹åŠ¨é‡è½½æ¨¡å‹APIï¼ˆä»…å¼€å‘ï¼‰ |

### æ¨èé…ç½®ç»„åˆ

#### ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼Œæ— GPUï¼‰
```bash
EXAMPAPER_STEP1_INPROC=1
EXAMPAPER_PPSTRUCTURE_WARMUP=1
EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC=0
EXAMPAPER_STEP1_FALLBACK_SUBPROCESS=1
EXAMPAPER_LIGHT_TABLE=0
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆGPUåŠ é€Ÿï¼‰
```bash
# ä¸Šè¿°é…ç½® +
EXAMPAPER_USE_GPU=1
FLAGS_fraction_of_gpu_memory_to_use=0.8
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆGPUåŠ é€Ÿ + å¹¶å‘å¤„ç†ï¼Œæ¨èï¼‰
```bash
# æœ€ä½³æ€§èƒ½é…ç½®
EXAMPAPER_STEP1_INPROC=1
EXAMPAPER_PPSTRUCTURE_WARMUP=1
EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC=0
EXAMPAPER_STEP1_FALLBACK_SUBPROCESS=1
EXAMPAPER_USE_GPU=1
FLAGS_fraction_of_gpu_memory_to_use=0.8
EXAMPAPER_PARALLEL_EXTRACTION=1
EXAMPAPER_MAX_WORKERS=4
```

#### å¼€å‘è°ƒè¯•ç¯å¢ƒ
```bash
# å¿«é€Ÿå¯åŠ¨ï¼Œé¦–æ¬¡è¯·æ±‚æ—¶åŠ è½½æ¨¡å‹
EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC=1
EXAMPAPER_ALLOW_MODEL_RELOAD=1
```

### è·¯å¾„è§„èŒƒ

- âœ… ä½¿ç”¨ `Path` å¯¹è±¡
- âœ… ä½¿ç”¨é…ç½®ç³»ç»Ÿè·å–è·¯å¾„
- âœ… ä½¿ç”¨ `src.common.paths` å·¥å…·å‡½æ•°
- âŒ é¿å…ç¡¬ç¼–ç è·¯å¾„å­—ç¬¦ä¸²

### æ¨¡å‹ç¼“å­˜

- ç¦»çº¿æ¨¡å‹è·¯å¾„ï¼š`~/.paddlex/official_models`
- è‡ªåŠ¨fallbackæœºåˆ¶å·²å®ç°
- ä¸è¦å¤šæ¬¡åˆå§‹åŒ–æ¨¡å‹ï¼ˆä½¿ç”¨å•ä¾‹ï¼‰

---

## ğŸ“‹ æ ¸å¿ƒé€»è¾‘è¯´æ˜

### é¢˜ç›®æå–æµç¨‹

```
1. åŠ è½½PP-StructureV3ï¼ˆå•ä¾‹ï¼‰
   â†“
2. ç‰ˆé¢å—æŠ½å–ï¼ˆlayout_blocks_from_docï¼‰
   â†“
3. æ£€æµ‹section boundariesï¼ˆdetect_section_boundariesï¼‰
   â†“
4. æŒ‰é¢˜å·åˆ†æ®µ
   - è¯†åˆ«é¢˜å·æ­£åˆ™
   - ç¡®å®šæ¯é¢˜èŒƒå›´
   â†“
5. å¤„ç†è·¨é¡µç»­æ¥ï¼ˆdetect_continuation_blocksï¼‰
   - è¯†åˆ«ç»­æ¥å†…å®¹
   - è¯„ä¼°ç½®ä¿¡åº¦
   â†“
6. è®¡ç®—è£å‰ªæ¡†ï¼ˆcompute_smart_crop_boxï¼‰
   - åŠ¨æ€marginè®¡ç®—
   - æ’é™¤é¡µçœ‰é¡µè„š
   â†“
7. è£å‰ªå¹¶ä¿å­˜
   - ç”Ÿæˆé¢˜ç›®å›¾ç‰‡
   - ä¿å­˜meta.json
```

### æ™ºèƒ½è£å‰ªç®—æ³•

```python
# src/common/image.py
def compute_smart_crop_box(
    blocks: list[dict],
    page_size: tuple[int, int],
    footer_top: Optional[int] = None,
    use_full_width: bool = True,
    margin_ratio: float = 0.008,  # ç›¸å¯¹é¡µé¢å°ºå¯¸
    min_margin: int = 3,
    max_margin: int = 15,
) -> tuple[int, int, int, int]:
    """
    æ”¹è¿›ç‚¹ï¼š
    1. marginåŸºäºé¡µé¢å°ºå¯¸åŠ¨æ€è®¡ç®—
    2. è‡ªåŠ¨æ’é™¤header/footer/numberå—
    3. è€ƒè™‘footerä½ç½®é¿å…æˆªå…¥é¡µè„š
    """
```

### è·¨é¡µæ£€æµ‹ç®—æ³•

```python
# src/common/utils.py
def detect_continuation_blocks(
    blocks: list[dict],
    section_boundaries: Optional[set[int]] = None,
    prev_question_context: Optional[dict] = None,
) -> tuple[list[dict], float]:
    """
    è¿”å›ï¼š(ç»­æ¥å—åˆ—è¡¨, ç½®ä¿¡åº¦0.0-1.0)

    ç½®ä¿¡åº¦è¯„ä¼°ï¼š
    - 0.9: å€™é€‰å—<=2, ä½ç½®é è¿‘é¡¶éƒ¨
    - 0.7: å€™é€‰å—<=5
    - 0.5: å€™é€‰å—>5
    - 0.0: æ— ç»­æ¥æˆ–é‡åˆ°section boundary
    """
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ä¼˜åŒ–æ•ˆæœæ¦‚è§ˆ

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä»£ç ä¼˜åŒ–å | GPUåŠ é€Ÿå | æ€»æå‡ |
|------|--------|------------|-----------|--------|
| **å¯åŠ¨æ—¶é—´** | ~2ç§’ | 15-30ç§’ | 20-35ç§’ | -18ç§’ âš ï¸ |
| **é¦–æ¬¡è¯·æ±‚** | 10-30ç§’ | <1ç§’ | <0.3ç§’ | **30-100å€** âœ… |
| **æ¨ç†é€Ÿåº¦** | 1x (åŸºå‡†) | 1x | **3-10x** | **3-10å€** âœ… |
| **æ•´ä½“å¤„ç†** | 30-90ç§’ (3ä»»åŠ¡) | ~27ç§’ | **~15ç§’** | **2-6å€** âœ… |

### æ ¸å¿ƒæ”¹è¿›

#### ç¬¬1å±‚ï¼šä»£ç ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

| ä¼˜åŒ–é¡¹ | å®ç°æ–¹å¼ | æ•ˆæœ |
|--------|----------|------|
| **æ¨¡å‹é¢„çƒ­** | å¯åŠ¨æ—¶åŠ è½½ | æ¶ˆé™¤é¦–æ¬¡å»¶è¿Ÿ |
| **è¿›ç¨‹å†…æ‰§è¡Œ** | å…±äº«æ¨¡å‹å®ä¾‹ | é¿å…é‡å¤åŠ è½½ |
| **çº¿ç¨‹å®‰å…¨** | Lock æœºåˆ¶ | ä¿è¯ç¨³å®šæ€§ |
| **æ™ºèƒ½é¢„çƒ­** | 800x1100 åˆæˆå›¾ | è§¦å‘ JIT ç¼–è¯‘ |
| **ç¦ç”¨æ— ç”¨åˆ†æ”¯** | 7 ä¸ªå­æ¨¡å‹ç¦ç”¨ | å‡å°‘ 40% åŠ è½½ |

#### ç¬¬2å±‚ï¼šGPU åŠ é€Ÿï¼ˆå·²å®Œæˆï¼‰

| ä¼˜åŒ–é¡¹ | å®ç°æ–¹å¼ | æ•ˆæœ |
|--------|----------|------|
| **GPU æ¨ç†** | CUDA + RTX 3060 | **3-10å€åŠ é€Ÿ** |
| **æ˜¾å­˜ç®¡ç†** | 80% é™åˆ¶ (4.8GB) | é˜²æ­¢æ˜¾å­˜ä¸è¶³ |
| **è‡ªåŠ¨æ£€æµ‹** | è¿è¡Œæ—¶æ£€æŸ¥ | æ™ºèƒ½å›é€€ CPU |
| **å¥åº·ç›‘æ§** | GPU çŠ¶æ€ç«¯ç‚¹ | å®æ—¶ç›‘æ§ |

### å¥åº·æ£€æŸ¥ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | HTTPçŠ¶æ€ |
|------|------|------|---------|
| `/api/health/live` | GET | å­˜æ´»æ£€æŸ¥ï¼ˆè¿›ç¨‹æ˜¯å¦è¿è¡Œï¼‰ | 200 OK |
| `/api/health/ready` | GET | å°±ç»ªæ£€æŸ¥ï¼ˆæ¨¡å‹æ˜¯å¦åŠ è½½ï¼‰ | 200=å°±ç»ª / 503=æœªå°±ç»ª |
| `/api/health/models/ppstructure` | GET | æ¨¡å‹çŠ¶æ€è¯¦æƒ…ï¼ˆåŒ…å«GPUä¿¡æ¯ï¼‰ | 200 OK |
| `/api/health/models/ppstructure/reload` | POST | æ‰‹åŠ¨é‡è½½æ¨¡å‹ï¼ˆéœ€å¯ç”¨ï¼‰ | éœ€è¦ `EXAMPAPER_ALLOW_MODEL_RELOAD=1` |

**å°±ç»ªæ£€æŸ¥å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "status": "ready",
  "ppstructure": {
    "ready": true,
    "prewarmed": true,
    "gpu": {
      "enabled": true,
      "available": true,
      "device": "NVIDIA GeForce RTX 3060 Laptop GPU"
    }
  }
}
```

### GPU åŠ é€Ÿé…ç½®

**å¯ç”¨GPUåŠ é€Ÿ**ï¼ˆåœ¨ `start_web_fixed.bat` ä¸­å·²é…ç½®ï¼‰ï¼š
```batch
REM === GPU åŠ é€Ÿ ===
set EXAMPAPER_USE_GPU=1
set FLAGS_fraction_of_gpu_memory_to_use=0.8
```

**æ€§èƒ½æå‡**ï¼ˆåŸºäº RTX 3060 æµ‹è¯•ï¼‰ï¼š
- æ¨¡å‹åŠ è½½ï¼šI/Oç“¶é¢ˆï¼ŒGPUæå‡æœ‰é™ï¼ˆ0-10%ï¼‰
- æ¨¡å‹æ¨ç†ï¼š**3-10å€åŠ é€Ÿ**ï¼ˆè®¡ç®—å¯†é›†ä»»åŠ¡ï¼‰
- å®Œæ•´æµç¨‹ï¼š
  - å•ä»»åŠ¡ï¼š30ç§’ â†’ 0.5ç§’ï¼ˆæ¨ç†éƒ¨åˆ†ï¼‰
  - 10ä»»åŠ¡æ‰¹é‡ï¼š302ç§’ â†’ 35ç§’ï¼ˆ**8.6å€æå‡**ï¼‰

**ç¡¬ä»¶è¦æ±‚**ï¼š
- æ¨èï¼šNVIDIA GPU with CUDA support (RTX 2060+)
- æ˜¾å­˜ï¼šå»ºè®® 6GB+
- é©±åŠ¨ï¼šCUDA 11.x + cuDNN

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```bash
# è¿è¡ŒGPUåŸºå‡†æµ‹è¯•
python scripts/benchmark_gpu.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
============================================================
    Performance Comparison
============================================================

Metric                    CPU          GPU          Speedup
------------------------------------------------------------
Model Loading             15.32s       15.89s       0.96x
Warmup (1st inference)    12.45s       3.21s        3.88x
Total                     27.77s       19.10s       1.45x
Real Inference            4.23s        0.67s        6.31x

============================================================
[CONCLUSION]
  GPU provides 1.5x speedup - SIGNIFICANT!
============================================================
```

---

## ğŸ”§ å¼€å‘æŒ‡å—ï¼ˆç»™AIï¼‰

### 1. ä»£ç ä¿®æ”¹å»ºè®®

#### âœ… æ¨èåšæ³•

```python
# å¯¼å…¥æ–°æ¨¡å—
from src.common.ocr_models import get_ppstructure
from src.common.io import load_meta, save_meta
from src.common.image import crop_and_save
from src.common.paths import auto_latest_exam_dir

# ä½¿ç”¨é…ç½®ç³»ç»Ÿ
import yaml
with open('config/exam_gd_2025.yaml') as f:
    config = yaml.safe_load(f)
```

#### âŒ é¿å…åšæ³•

```python
# ä¸è¦åœ¨src/æ¨¡å—ä¸­ä½¿ç”¨æ ¹ç›®å½•çš„common.py
from common import xxx  # æ—§æ–¹å¼

# ä¸è¦ç¡¬ç¼–ç è·¯å¾„
img_dir = Path("pdf_images/è¯•å·å")  # åº”è¯¥ä½¿ç”¨é…ç½®
```

### 2. æ·»åŠ æ–°åŠŸèƒ½

1. **ç¡®å®šæ¨¡å—ä½ç½®**ï¼š
   - å›¾ç‰‡å¤„ç† â†’ `src/common/image.py`
   - OCRç›¸å…³ â†’ `src/common/ocr_models.py`
   - è·¯å¾„å·¥å…· â†’ `src/common/paths.py`
   - æ–°çš„æ ¸å¿ƒç®—æ³• â†’ `src/core/`

2. **æ·»åŠ é…ç½®é¡¹**ï¼š
   - åœ¨ `config/global_settings.yaml` æ·»åŠ é»˜è®¤å€¼
   - åœ¨è¯•å·é…ç½®ä¸­å¯è¦†ç›–

3. **æ›´æ–°æ–‡æ¡£**ï¼š
   - æ›´æ–°æœ¬æ–‡æ¡£çš„ç›¸å…³ç« èŠ‚
   - æ›´æ–°æ ¹ç›®å½• README.md

### 3. æ•°æ®ç®¡ç†

#### v2.0æ•°æ®ç»“æ„

```
data/output/{exam_id}/
â”œâ”€â”€ pages/              # æ•´é¡µå›¾ç‰‡
â”‚   â””â”€â”€ page_*.png
â”œâ”€â”€ questions/          # åˆ‡å¥½çš„é¢˜ç›®
â”‚   â”œâ”€â”€ questions_page_*/
â”‚   â”‚   â”œâ”€â”€ q*.png
â”‚   â”‚   â””â”€â”€ meta.json
â”‚   â””â”€â”€ all_questions/  # æ±‡æ€»
â”œâ”€â”€ metadata.json       # è¯•å·å…ƒæ•°æ®
â””â”€â”€ exam_questions.json # é¢˜ç›®æ±‡æ€»
```

#### è¿ç§»v1.xæ•°æ®

```bash
# å…ˆæ¨¡æ‹Ÿè¿è¡Œ
python scripts/migrate_data_v1_to_v2.py --dry-run

# ç¡®è®¤åæ‰§è¡Œ
python scripts/migrate_data_v1_to_v2.py

# è¿ç§»åéªŒè¯ï¼ˆå¯åŠ¨WebæœåŠ¡æŸ¥çœ‹å†å²ï¼‰
python web_interface/app.py
```

---

## ğŸ› æ•…éšœæ’é™¤

### ç”¨æˆ·å¸¸è§é—®é¢˜

#### Q: å¯åŠ¨å¤±è´¥ï¼Œæç¤ºç¼ºå°‘ä¾èµ–ï¼Ÿ
**A:** ç¡®ä¿å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
pip install -r web_requirements.txt  # Webç•Œé¢
```

#### Q: ä¸Šä¼ æ–‡ä»¶åä¸€ç›´åœ¨ã€Œç­‰å¾…ã€çŠ¶æ€ï¼Ÿ
**A:** æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼Œå¯èƒ½æ˜¯ï¼š
- PaddleOCR æ¨¡å‹æ­£åœ¨ä¸‹è½½ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
- Python ç¯å¢ƒé—®é¢˜
- ç£ç›˜ç©ºé—´ä¸è¶³

#### Q: é¢˜ç›®åˆ‡åˆ†ä¸å‡†ç¡®ï¼Ÿ
**A:** å·¥å…·é’ˆå¯¹æ ‡å‡†æ ¼å¼è¡Œæµ‹è¯•å·ä¼˜åŒ–ï¼Œç‰¹æ®Šæ ¼å¼å¯èƒ½éœ€è¦è°ƒæ•´ç®—æ³•å‚æ•°ã€‚

#### Q: å¤„ç†æ—¶é—´è¿‡é•¿ï¼Ÿ
**A:** å°è¯•å¯ç”¨GPUåŠ é€Ÿï¼ˆéœ€è¦NVIDIA GPUï¼‰ï¼š
```bash
set EXAMPAPER_USE_GPU=1  # Windows
export EXAMPAPER_USE_GPU=1  # Linux/Mac
```

### å¼€å‘/è¿ç»´é—®é¢˜

#### å¯¼å…¥é”™è¯¯
```python
# é”™è¯¯ï¼šModuleNotFoundError: No module named 'src'
# è§£å†³ï¼šç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼Œæˆ–ä½¿ç”¨ç›¸å¯¹å¯¼å…¥

# æ­£ç¡®æ–¹å¼1ï¼šä»æ ¹ç›®å½•è¿è¡Œ
python manage.py

# æ­£ç¡®æ–¹å¼2ï¼šä½¿ç”¨å‘åå…¼å®¹å±‚
from common import get_ppstructure  # ä»ç„¶æœ‰æ•ˆ
```

#### é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
```bash
# é”™è¯¯ï¼šFileNotFoundError: config/exam_xxx.yaml
# è§£å†³ï¼šå¤åˆ¶æ¨¡æ¿åˆ›å»ºæ–°é…ç½®

cp config/exam_gd_2025.yaml config/exam_new.yaml
# ç„¶åä¿®æ”¹exam_infoéƒ¨åˆ†
```

#### æœåŠ¡å¯åŠ¨æ—¶é—´è¿‡é•¿
**ç°è±¡**: `start_web_fixed.bat` å¯åŠ¨éœ€è¦ 15-30ç§’

**åŸå› **: æ¨¡å‹é¢„çƒ­éœ€è¦æ—¶é—´

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆA: å¼‚æ­¥é¢„çƒ­ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
set EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC=1

# æ–¹æ¡ˆB: ç¦ç”¨é¢„çƒ­ï¼ˆä¸æ¨èï¼Œé¦–æ¬¡è¯·æ±‚ä¼šæ…¢ï¼‰
set EXAMPAPER_PPSTRUCTURE_WARMUP=0
```

#### é¦–æ¬¡è¯·æ±‚ä»ç„¶å¾ˆæ…¢
**è¯Šæ–­æ­¥éª¤**:

1. æ£€æŸ¥æ¨¡å‹æ˜¯å¦é¢„çƒ­æˆåŠŸï¼š
```bash
curl http://localhost:8000/api/health/ready
```

2. æ­£å¸¸è¾“å‡ºï¼š
```json
{"status": "ready", "ppstructure": {"ready": true, "prewarmed": true}}
```

3. éªŒè¯ç¯å¢ƒå˜é‡ï¼š
```python
import os
print(os.getenv("EXAMPAPER_STEP1_INPROC"))  # åº”ä¸º "1"
print(os.getenv("EXAMPAPER_PPSTRUCTURE_WARMUP"))  # åº”ä¸º "1"
```

#### è¿›ç¨‹å†…æ‰§è¡Œå¤±è´¥
**ç°è±¡**: æ—¥å¿—æ˜¾ç¤º "âœ— é¢˜ç›®æå–(in-proc) å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¸´æ—¶å›é€€åˆ°å­è¿›ç¨‹æ¨¡å¼
set EXAMPAPER_STEP1_INPROC=0

# æˆ–å¯ç”¨å›é€€æœºåˆ¶ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
set EXAMPAPER_STEP1_FALLBACK_SUBPROCESS=1
```

#### å†…å­˜å ç”¨è¿‡é«˜
**ç°è±¡**: Webè¿›ç¨‹å ç”¨2GB+å†…å­˜

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¦ç”¨è¡¨æ ¼è¯†åˆ«ï¼ˆä¼šå½±å“èµ„æ–™åˆ†æï¼‰
set EXAMPAPER_LIGHT_TABLE=1
```
âš ï¸ **æ³¨æ„**: è¿™ä¼šå½±å“èµ„æ–™åˆ†æå¤§é¢˜çš„å¤„ç†è´¨é‡ï¼

#### GPUç›¸å…³é—®é¢˜

**Q: GPUåŠ é€Ÿä¸ç”Ÿæ•ˆï¼Ÿ**
```bash
# æ£€æŸ¥GPUçŠ¶æ€
curl http://localhost:8000/api/health/models/ppstructure

# é¢„æœŸè¾“å‡ºåº”åŒ…å«ï¼š
# "gpu": {"enabled": true, "available": true, "device": "..."}
```

**Q: æ˜¾å­˜ä¸è¶³ï¼Ÿ**
```bash
# é™ä½æ˜¾å­˜ä½¿ç”¨é™åˆ¶
set FLAGS_fraction_of_gpu_memory_to_use=0.6  # ä»80%é™è‡³60%
```

---

## âš ï¸ é‡è¦çº¦å®šï¼ˆå¿…è¯»ï¼ï¼‰

### 1. ä¸è¦ä¿®æ”¹çš„å†…å®¹

- âŒ **`pdf_images/questions_page6`** (æ— ä¸‹åˆ’çº¿)
  - äººå·¥ç²¾è°ƒçš„"é»„é‡‘æ ‡å‡†"
  - ä»»ä½•è„šæœ¬å’ŒAIéƒ½ä¸è¦æ”¹åŠ¨

### 2. é…ç½®ä¼˜å…ˆçº§

```
ç¡¬ç¼–ç  < å…¨å±€é…ç½® < è¯•å·é…ç½® < å‘½ä»¤è¡Œå‚æ•°
```

å§‹ç»ˆä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œé¿å…ç¡¬ç¼–ç ã€‚

### 3. è·¯å¾„è§„èŒƒ

- âœ… ä½¿ç”¨ `Path` å¯¹è±¡
- âœ… ä½¿ç”¨é…ç½®ç³»ç»Ÿè·å–è·¯å¾„
- âœ… ä½¿ç”¨ `src.common.paths` å·¥å…·å‡½æ•°
- âŒ é¿å…ç¡¬ç¼–ç è·¯å¾„å­—ç¬¦ä¸²

### 4. æ¨¡å‹ç¼“å­˜

- ç¦»çº¿æ¨¡å‹è·¯å¾„ï¼š`~/.paddlex/official_models`
- è‡ªåŠ¨fallbackæœºåˆ¶å·²å®ç°
- ä¸è¦å¤šæ¬¡åˆå§‹åŒ–æ¨¡å‹ï¼ˆä½¿ç”¨å•ä¾‹ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](../README.md) - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [PaddleOCRå®Œæ•´ä½¿ç”¨æŒ‡å—.md](PaddleOCRå®Œæ•´ä½¿ç”¨æŒ‡å—.md) - OCRæŠ€æœ¯æ–‡æ¡£
- [config/README.md](../config/README.md) - é…ç½®ç³»ç»Ÿè¯´æ˜
- [scripts/archived/README.md](../scripts/archived/README.md) - å½’æ¡£ä»£ç è¯´æ˜

---

## ğŸ¤– ç»™AIçš„æç¤º

### å¦‚æœä½ è¦ä¿®æ”¹ä»£ç 

1. **ä¼˜å…ˆæŸ¥çœ‹**ï¼š
   - æœ¬æ–‡æ¡£çš„"æ ¸å¿ƒæ¨¡å—è¯´æ˜"
   - ç›¸å…³æ¨¡å—çš„docstring
   - `config/global_settings.yaml`

2. **ä¿®æ”¹å‰ç¡®è®¤**ï¼š
   - æ˜¯å¦å½±å“å‘åå…¼å®¹æ€§ï¼Ÿ
   - æ˜¯å¦éœ€è¦æ›´æ–°é…ç½®æ–‡ä»¶ï¼Ÿ
   - æ˜¯å¦éœ€è¦æ•°æ®è¿ç§»ï¼Ÿ

3. **æµ‹è¯•æ–¹æ³•**ï¼š
   ```bash
   # åŸºæœ¬åŠŸèƒ½æµ‹è¯•ï¼ˆå¯åŠ¨WebæŸ¥çœ‹ï¼‰
   python web_interface/app.py

   # å•ç‹¬æµ‹è¯•æ¨¡å—
   python -c "from src.common import get_ppstructure; print('OK')"

   # GPUåŸºå‡†æµ‹è¯•
   python scripts/benchmark_gpu.py
   ```

### å¦‚æœé‡åˆ°é—®é¢˜

1. æ£€æŸ¥ `.gitignore` æ˜¯å¦æ­£ç¡®æ’é™¤æ•°æ®
2. æ£€æŸ¥ `common.py` å‘åå…¼å®¹å±‚æ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹å¥åº·æ£€æŸ¥ç«¯ç‚¹è·å–æ¨¡å‹çŠ¶æ€
5. æŸ¥é˜…æœ¬æ–‡æ¡£çš„"æ•…éšœæ’é™¤"ç« èŠ‚

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **å¯åŠ¨æ…¢**: è€ƒè™‘å¼‚æ­¥é¢„çƒ­ (`EXAMPAPER_PPSTRUCTURE_WARMUP_ASYNC=1`)
- **æ¨ç†æ…¢**: å¯ç”¨GPUåŠ é€Ÿ (`EXAMPAPER_USE_GPU=1`)
- **å†…å­˜é«˜**: è€ƒè™‘ç¦ç”¨è¡¨æ ¼è¯†åˆ« (`EXAMPAPER_LIGHT_TABLE=1`ï¼Œä½†ä¼šå½±å“èµ„æ–™åˆ†æ)
- **å·²è¾¾æé™**: åœ¨ç»™å®šç¡¬ä»¶å’Œçº¦æŸä¸‹ï¼Œå½“å‰é…ç½®å·²æ˜¯æœ€ä¼˜

---

## ğŸ“ å˜æ›´è®°å½• & å·²çŸ¥é—®é¢˜

### v2.0.2 (2025-12-13)

**æ–°åŠŸèƒ½ï¼šé¡µé¢çº§å¹¶å‘å¤„ç†**

1. **å¹¶å‘æå–æ¨¡å—** (`src/services/parallel_extraction.py`)
   - æ–°å¢ `ParallelPageProcessor` ç±»ï¼Œæ”¯æŒé¡µé¢çº§å¹¶å‘OCRå¤„ç†
   - ä½¿ç”¨ `ThreadPoolExecutor` å®ç°å¤šçº¿ç¨‹å¹¶å‘
   - é€šè¿‡ `Semaphore(1)` ä¸²è¡ŒåŒ–GPUæ¨ç†ï¼Œé¿å…æ˜¾å­˜æº¢å‡º
   - æ”¯æŒå®æ—¶è¿›åº¦å›è°ƒ

2. **ä¸¤é˜¶æ®µå¤„ç†æ¶æ„**
   - **é˜¶æ®µ1**: å¹¶å‘å¤„ç†ç‹¬ç«‹é¡µé¢ï¼ˆCPUé¢„å¤„ç†/åå¤„ç†å¯å¹¶å‘ï¼ŒGPUæ¨ç†ä¸²è¡Œï¼‰
   - **é˜¶æ®µ2**: é¡ºåºå¤„ç†è·¨é¡µé¢˜ç›®æ£€æµ‹ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰

3. **é…ç½®é€‰é¡¹**
   - `EXAMPAPER_PARALLEL_EXTRACTION=1`: å¯ç”¨å¹¶å‘å¤„ç†
   - `EXAMPAPER_MAX_WORKERS=4`: è®¾ç½®workeræ•°é‡ï¼ˆå»ºè®®2-6ï¼‰

4. **å¯åŠ¨è„šæœ¬æ›´æ–°**
   - `start_web_fixed.bat`: å·²æ·»åŠ å¹¶å‘é…ç½®
   - `start_web_production.bat`: å·²æ·»åŠ å¹¶å‘é…ç½®

**æ€§èƒ½æå‡**ï¼ˆåŸºäº RTX 3060 + Ryzen 7 5800H æµ‹è¯•ï¼‰ï¼š
- å°è¯•å·ï¼ˆ10-20é¡µï¼‰ï¼šçº¦2å€åŠ é€Ÿ
- å¤§è¯•å·ï¼ˆ40-50é¡µï¼‰ï¼šçº¦2.5-3å€åŠ é€Ÿ
- å†…å­˜å¢åŠ ï¼šçº¦1-2GBï¼ˆ4ä¸ªworkerçš„ä¸­é—´ç»“æœï¼‰

**æŠ€æœ¯ç»†èŠ‚**ï¼š
- GPUæ¨ç†ä»ç„¶æ˜¯ä¸²è¡Œçš„ï¼ˆé¿å…6GBæ˜¾å­˜æº¢å‡ºï¼‰
- CPUå¯†é›†å‹æ“ä½œï¼ˆå›¾åƒåŠ è½½ã€è£å‰ªã€ä¿å­˜ï¼‰å¯å¹¶å‘æ‰§è¡Œ
- å‘åå…¼å®¹ï¼šé»˜è®¤å…³é—­å¹¶å‘ï¼ˆ`parallel=False`ï¼‰

### v2.0.1 (2025-12-12)

**æ€§èƒ½ä¼˜åŒ–**ï¼š
1. **æ¨¡å‹é¢„çƒ­æœºåˆ¶** - å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½PP-StructureV3ï¼Œæ¶ˆé™¤é¦–æ¬¡è¯·æ±‚å»¶è¿Ÿ
2. **è¿›ç¨‹å†…æ‰§è¡Œ** - é¿å…å­è¿›ç¨‹é‡å¤åŠ è½½æ¨¡å‹ï¼Œæå‡å“åº”é€Ÿåº¦
3. **GPUåŠ é€Ÿæ”¯æŒ** - æ¨ç†é€Ÿåº¦æå‡3-10å€ï¼ˆRTX 3060æµ‹è¯•ï¼‰
4. **å¥åº·æ£€æŸ¥ç«¯ç‚¹** - å®Œå–„ç›‘æ§ä½“ç³»ï¼Œæ”¯æŒK8s/Dockeréƒ¨ç½²

**åŠŸèƒ½æ”¹è¿›**ï¼š
1. **è·¯å¾„è§£æå¢å¼º** (`src/common/paths.py:28-80`)
   - **é—®é¢˜**: meta.json ä¸­å­˜å‚¨çš„è·¯å¾„åŒ…å«æ—§ç›®å½•åï¼ˆå¦‚ `_v2` åç¼€ï¼‰ï¼Œä½†å®é™…ç›®å½•å·²é‡å‘½å
   - **ä¿®å¤**: `resolve_image_path` ç°åœ¨æ”¯æŒï¼š
     - è·¨å¹³å°è·¯å¾„åˆ†éš”ç¬¦è§„èŒƒåŒ–
     - æå– `questions_page_X/filename` éƒ¨åˆ†è¿›è¡Œæ™ºèƒ½åŒ¹é…
     - æ–‡ä»¶åå…œåº•æœç´¢æœºåˆ¶
   - **å½±å“**: ä¿®å¤ Web ç•Œé¢æ­¥éª¤4ï¼ˆç»“æœæ±‡æ€»ï¼‰æ— æ³•å¤åˆ¶é¢˜ç›®å›¾ç‰‡çš„é—®é¢˜

2. **èµ„æ–™åˆ†æå¤§é¢˜æ‹¼æ¥ä¼˜åŒ–** (`make_data_analysis_big.py:189`)
   - **é—®é¢˜**: ææ–™å›¾ç‰‡å’Œé¢˜ç›®å›¾ç‰‡ä¹‹é—´é—´éš™è¿‡å°ï¼ˆ50pxï¼‰ï¼Œå¯¼è‡´å¤§æ¨¡å‹è¯†åˆ«å›°éš¾
   - **ä¿®å¤**: å¢åŠ å‚ç›´é—´éš™è‡³ 200pxï¼Œæå‡å¯è¯»æ€§
   - **å½±å“**: æ”¹å–„ all_questions ç›®å½•ä¸­ `data_analysis_*.png` çš„è§†è§‰è´¨é‡

3. **CLI å·¥å…·ç®€åŒ–**
   - **å˜æ›´**: ç§»é™¤ç‹¬ç«‹çš„ `cli_menu.py`ï¼Œç»Ÿä¸€ä½¿ç”¨ `manage.py` å’Œ Web ç•Œé¢
   - **æ¨è**: Windows ç”¨æˆ·ä½¿ç”¨ `start_web_fixed.bat` å¿«æ·å¯åŠ¨

### æ€§èƒ½æ•°æ®ï¼ˆå‚è€ƒï¼‰

åŸºäº **RTX 3060 + Ryzen 7 5800H + 24GB RAM** æµ‹è¯•ï¼š

| åœºæ™¯ | CPUæ¨¡å¼ | GPUæ¨¡å¼ | æå‡ |
|------|---------|---------|------|
| å•ä»»åŠ¡æ¨ç† | ~3-5ç§’ | ~0.3-1ç§’ | 3-10x |
| 10ä»»åŠ¡æ‰¹é‡ | ~302ç§’ | ~35ç§’ | 8.6x |
| å¯åŠ¨æ—¶é—´ | ~2ç§’ | ~30ç§’ | -28ç§’ï¼ˆé¢„çƒ­å¼€é”€ï¼‰ |

**ç»“è®º**: åœ¨ä¸å½±å“å‡†ç¡®åº¦å’ŒåŠŸèƒ½çš„å‰æä¸‹ï¼Œå·²è¾¾åˆ°ä»£ç å’Œç¡¬ä»¶çš„åŒé‡æé™ä¼˜åŒ–ã€‚

---

**ç‰ˆæœ¬**: v2.0.2
**æœ€åæ›´æ–°**: 2025-12-13
**é‡æ„å®Œæˆ**: âœ… æ ¸å¿ƒæ¶æ„å·²é‡æ„å®Œæˆï¼Œå‘åå…¼å®¹
**æ€§èƒ½ä¼˜åŒ–**: âœ… å·²è¾¾åˆ°ç¡¬ä»¶ç†è®ºæé™
**å¹¶å‘å¤„ç†**: âœ… é¡µé¢çº§å¹¶å‘æå–å·²å®ç°
